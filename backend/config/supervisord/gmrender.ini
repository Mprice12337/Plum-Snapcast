# gmrender-resurrect (DLNA/UPnP Media Renderer) - Conditional start based on DLNA_ENABLED
# Built from source with GStreamer for audio processing and UPnP discovery via Avahi
# Outputs audio to FIFO pipe for Snapcast integration
[program:gmrender]
command=/bin/sh -c 'if [ "${DLNA_ENABLED}" = "1" ]; then UUID_ARG=""; if [ -n "${DLNA_UUID}" ]; then UUID_ARG="--uuid ${DLNA_UUID}"; fi; sleep 5 && /usr/local/bin/gmediarender --friendly-name "${DLNA_DEVICE_NAME}" $UUID_ARG --gstout-audiopipe "audioresample ! audio/x-raw,rate=44100,format=S16LE,channels=2 ! filesink location=/tmp/dlna-fifo" --gstout-audiodevice "" --logfile stdout; else sleep infinity; fi'
user=snapcast
directory=/app
environment=HOME="/app",GST_DEBUG="2",DISPLAY=":0"
priority=50
autostart=true
autorestart=true
startsecs=10
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisord/gmrender.log
stdout_logfile_maxbytes=50MB
stderr_logfile=/var/log/supervisord/gmrender_err.log
stderr_logfile_maxbytes=10MB
