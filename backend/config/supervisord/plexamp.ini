# Plexamp Headless - Conditional start based on PLEXAMP_ENABLED
# Plex music player that appears as a cast target in mobile apps
# Requires Plex Pass and claim token for initial setup
[program:plexamp]
command=/bin/sh -c 'if [ "${PLEXAMP_ENABLED}" = "1" ]; then cd /opt/plexamp && ALSA_CONFIG_PATH=/app/config/asound.conf /usr/bin/node /opt/plexamp/js/index.js; else sleep infinity; fi'
user=snapcast
directory=/opt/plexamp
environment=HOME="/app/plexamp",NODE_ENV="production",ALSA_CONFIG_PATH="/app/config/asound.conf"
priority=50
autostart=true
autorestart=true
startsecs=15
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisord/plexamp.log
stdout_logfile_maxbytes=50MB
stderr_logfile=/var/log/supervisord/plexamp_err.log
stderr_logfile_maxbytes=10MB
