# Bluetooth service starter (manages starting Bluetooth services if enabled)
[program:bluetooth-starter]
command=/bin/bash /app/scripts/start-bluetooth-services.sh
user=root
priority=5
autostart=true
autorestart=false
startsecs=1
stdout_logfile=/var/log/supervisord/bluetooth-starter.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisord/bluetooth-starter_err.log
stderr_logfile_maxbytes=10MB

# Bluetooth daemon
[program:bluetoothd]
command=/usr/lib/bluetooth/bluetoothd --noplugin=sap
user=root
priority=15
autostart=false
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/var/log/supervisord/bluetoothd.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisord/bluetoothd_err.log
stderr_logfile_maxbytes=10MB

# Bluetooth initialization (pairing, discoverable, etc.)
[program:bluetooth-init]
command=/bin/bash /app/scripts/bluetooth-init.sh
user=root
priority=20
autostart=false
autorestart=true
startsecs=10
startretries=3
stdout_logfile=/var/log/supervisord/bluetooth-init.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisord/bluetooth-init_err.log
stderr_logfile_maxbytes=10MB

# BlueALSA daemon (Bluetooth audio over ALSA)
[program:bluealsa]
command=/bin/sh -c "while [ ! -S /var/run/dbus/system_bus_socket ]; do sleep 0.5; done && sleep 2 && /usr/bin/bluealsa --profile=a2dp-source --profile=a2dp-sink"
user=root
priority=25
autostart=false
autorestart=true
startsecs=10
startretries=3
stdout_logfile=/var/log/supervisord/bluealsa.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisord/bluealsa_err.log
stderr_logfile_maxbytes=10MB

# BlueALSA audio capture (Alpine uses ALSA plugins, not bluealsa-aplay)
# NOTE: Alpine's bluez-alsa doesn't include bluealsa-aplay utility
# Instead, audio capture happens via ALSA PCM plugins when devices connect
# We monitor for connected devices and capture using arecord with bluealsa device
[program:bluealsa-aplay]
command=/bin/sh -c "while [ ! -p /tmp/bluetooth-fifo ]; do sleep 1; done && while true; do arecord -D bluealsa -f cd -c 2 2>/dev/null | tee /tmp/bluetooth-fifo; sleep 1; done"
user=root
priority=30
autostart=false
autorestart=true
startsecs=10
startretries=3
stdout_logfile=/var/log/supervisord/bluealsa-aplay.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/supervisord/bluealsa-aplay_err.log
stderr_logfile_maxbytes=10MB
