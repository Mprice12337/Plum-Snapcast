# Spotifyd (Spotify Connect) - Conditional start based on SPOTIFY_CONFIG_ENABLED
# Built from source with D-Bus MPRIS support for metadata and playback control
# spotifyd is a Spotify daemon built on librespot with working MPRIS support
[program:spotifyd]
command=/bin/sh -c 'if [ "${SPOTIFY_CONFIG_ENABLED}" = "1" ]; then sleep 5 && /usr/local/bin/spotifyd --no-daemon --no-zeroconf --config-path /app/config/spotifyd.conf --device-name "${SPOTIFY_DEVICE_NAME}" --bitrate ${SPOTIFY_BITRATE}; else sleep infinity; fi'
user=snapcast
directory=/app
environment=HOME="/app",RUST_LOG="info"
priority=45
autostart=true
autorestart=true
startsecs=10
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisord/spotifyd.log
stdout_logfile_maxbytes=50MB
stderr_logfile=/var/log/supervisord/spotifyd_err.log
stderr_logfile_maxbytes=10MB
