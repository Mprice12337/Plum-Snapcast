# Librespot (Spotify Connect) - Conditional start based on SPOTIFY_CONFIG_ENABLED
# NOTE: Alpine's librespot 0.7.1 doesn't include D-Bus MPRIS support
# This means no metadata or playback controls - audio only
[program:librespot]
command=/bin/sh -c 'if [ "${SPOTIFY_CONFIG_ENABLED}" = "1" ]; then sleep 5 && /usr/bin/librespot --name "${SPOTIFY_DEVICE_NAME}" --backend pipe --device /tmp/spotifyfifo --bitrate ${SPOTIFY_BITRATE} --enable-volume-normalisation --initial-volume 50 --device-type speaker --cache /tmp/spotify-cache --format S16; else sleep infinity; fi'
user=snapcast
directory=/app
environment=HOME="/app",RUST_LOG="info"
priority=45
autostart=true
autorestart=true
startsecs=10
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/supervisord/librespot.log
stdout_logfile_maxbytes=50MB
stderr_logfile=/var/log/supervisord/librespot_err.log
stderr_logfile_maxbytes=10MB
